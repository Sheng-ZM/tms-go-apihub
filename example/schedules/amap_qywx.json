{
    "name": "handle_send",
    "description": "处理输入并发送微信",
    "ConcurrentNum": 2,
    "tasks": [
        {
            "type": "control",
            "name": "myloop",
            "command": "loop",
            "resultKey": "myloop",
            "concurrent": true,
            "concurrentLoopNum": 2,
            "key": {
                "from": "template",
                "name": "{{len .origin.cities}}"
            },
            "tasks": [
                {
                    "type": "control",
                    "name": "chooseType",
                    "command": "switch",
                    "key": {
                        "from": "template",
                        "name": "{{index .origin.cities .loop.myloop}}"
                    },
                    "cases": [
                        {
                            "value": "sh",
                            "tasks": [
                                {
                                    "type": "flow",
                                    "name": "amap_city_weather_sh",
                                    "command": "amap_city_weather",
                                    "resultKey": "weather",
                                    "parameters": [
                                        {
                                            "name": "city",
                                            "value": "上海"
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "value": "bj",
                            "tasks": [
                                {
                                    "type": "flow",
                                    "name": "amap_city_weather_bj",
                                    "command": "amap_city_weather",
                                    "resultKey": "weather",
                                    "parameters": [
                                        {
                                            "name": "city",
                                            "value": "北京"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "type": "flow",
            "name": "image",
            "command": "baidu_image_classify",
            "Concurrent": true,
            "resultKey": "image",
            "parameters": [
                {
                    "name": "content",
                    "from": {
                        "from": "origin",
                        "name": "image"
                    }
                }
            ]
        },        
        {
            "type": "flow",
            "name": "message",
            "command": "qywx_message_send",
            "parameters": [
                {
                    "name": "content",
                    "from": {
                        "from": "template",
                        "name": "{{range $i,$v := .myloop}}{{if $i}},{{end}}{{$v.data.region}} weather is {{$v.data.weather}}{{end}}, and image is {{(index .image.result 0).name}}"
                    }
                },
                {
                    "name": "touser",
                    "value": "YangYue"
                },
                {
                    "name": "msgtype",
                    "value": "text"
                },
                {
                    "name": "agentid",
                    "value": "1000002"
                }
            ]
        }
    ]
}