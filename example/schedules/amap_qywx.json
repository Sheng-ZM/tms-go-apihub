{
    "name": "handle_send",
    "description": "处理输入并发送微信",
    "ConcurrentNum": 2,
    "steps": [
        {
            "type": "control",
            "name": "loop",
            "resultKey": "myloop",
            "concurrent": true,
            "concurrentLoopNum": 2,
            "key": {
                "from": "template",
                "content": "{{len .origin.cities}}"
            },
            "steps": [
                {
                    "type": "control",
                    "name": "switch",
                    "key": {
                        "from": "template",
                        "content": "{{index .origin.cities .loop.myloop}}"
                    },
                    "cases": [
                        {
                            "value": "sh",
                            "steps": [
                                {
                                    "type": "flow",
                                    "name": "amap_city_weather",
                                    "resultKey": "weather",
                                    "parameters": [
                                        {
                                            "name": "city",
                                            "value": {
                                                "from": "literal",
                                                "content": "上海"
                                            }
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            "value": "bj",
                            "steps": [
                                {
                                    "type": "flow",
                                    "name": "amap_city_weather",
                                    "resultKey": "weather",
                                    "parameters": [
                                        {
                                            "name": "city",
                                            "value": {
                                                "from": "literal",
                                                "content": "北京"
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "type": "flow",
            "name": "baidu_image_classify",
            "Concurrent": true,
            "resultKey": "image",
            "parameters": [
                {
                    "name": "content",
                    "value": {
                        "from": "origin",
                        "content": "image"
                    }
                }
            ]
        },
        {
            "type": "flow",
            "name": "qywx_message_send",
            "parameters": [
                {
                    "name": "content",
                    "value": {
                        "from": "template",
                        "content": "{{range $i,$v := .myloop}}{{if $i}},{{end}}{{$v.data.region}} weather is {{$v.data.weather}}{{end}}, and image is {{(index .image.result 0).name}}"
                    }
                },
                {
                    "name": "touser",
                    "value": {
                        "from": "literal",
                        "content": "YangYue"
                    }
                },
                {
                    "name": "msgtype",
                    "value": {
                        "from": "literal",
                        "content": "text"
                    }
                },
                {
                    "name": "agentid",
                    "value": {
                        "from": "literal",
                        "content": "1000002"
                    }
                }
            ]
        }
    ]
}